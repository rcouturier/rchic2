name: Build Portable Folder (All Platforms)

on:
  push:
    tags:
      - 'v*'
  workflow_dispatch:
    inputs:
      create_release:
        description: 'Create a GitHub release'
        required: false
        default: 'false'
        type: boolean

jobs:
  # ============================================================================
  # Linux Build
  # ============================================================================
  build-linux:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'
          cache-dependency-path: electron/package-lock.json

      - name: Setup R
        uses: r-lib/actions/setup-r@v2
        with:
          r-version: '4.4.2'

      - name: Install system dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y libcurl4-openssl-dev libssl-dev libxml2-dev libsodium-dev libicu-dev graphviz libgraphviz-dev

      - name: Install R packages
        run: |
          install.packages(c('plumber', 'jsonlite', 'promises', 'future', 'later',
                             'httpuv', 'webutils', 'swagger', 'magrittr', 'crayon',
                             'ellipsis', 'lifecycle', 'rlang', 'R6', 'stringi',
                             'sodium', 'digest', 'globals', 'listenv', 'parallelly', 'Rcpp',
                             'stringr', 'tcltk2', 'BiocManager'),
                           repos = 'https://cloud.r-project.org',
                           dependencies = c('Depends', 'Imports', 'LinkingTo'))
          BiocManager::install('Rgraphviz', ask = FALSE, update = FALSE)
        shell: Rscript {0}

      - name: Prepare R Portable for Linux
        run: |
          OUTPUT_DIR="electron/R-portable-linux"
          R_HOME=$(R RHOME)

          echo "R_HOME: $R_HOME"

          # Create output directory and copy R
          mkdir -p "$OUTPUT_DIR"
          cp -R "$R_HOME"/* "$OUTPUT_DIR/"

          # Create bin directory with executables
          mkdir -p "$OUTPUT_DIR/bin"
          cp "$R_HOME/bin/R" "$OUTPUT_DIR/bin/" 2>/dev/null || true
          cp "$R_HOME/bin/Rscript" "$OUTPUT_DIR/bin/" 2>/dev/null || true
          chmod +x "$OUTPUT_DIR/bin/R" 2>/dev/null || true
          chmod +x "$OUTPUT_DIR/bin/Rscript" 2>/dev/null || true

          # Copy installed packages from R_LIBS_USER to R portable
          if [ -d "$R_LIBS_USER" ]; then
            echo "Copying packages from $R_LIBS_USER to $OUTPUT_DIR/library"
            cp -R "$R_LIBS_USER"/* "$OUTPUT_DIR/library/" 2>/dev/null || true
          fi

          echo "R Portable prepared at $OUTPUT_DIR"
          ls -la "$OUTPUT_DIR/library" | head -30

      - name: Install rchic package from source
        run: |
          R CMD INSTALL --library=electron/R-portable-linux/library .

      - name: Verify R installation
        run: |
          export R_HOME="electron/R-portable-linux"
          Rscript -e ".libPaths('electron/R-portable-linux/library'); library(plumber); cat('plumber OK\n'); library(rchic); cat('rchic OK\n')"

      - name: Install npm dependencies
        run: |
          cd electron
          npm ci

      - name: Build Linux portable folder
        run: |
          cd electron
          npm run build:linux-portable-folder
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Create ZIP archive
        run: |
          cd electron/dist-portable-folder
          zip -r Rchic2-Portable-Linux.zip linux-unpacked

      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: Rchic2-Portable-Linux
          path: electron/dist-portable-folder/Rchic2-Portable-Linux.zip
          retention-days: 30

  # ============================================================================
  # macOS Build (Intel + ARM)
  # ============================================================================
  build-macos:
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        include:
          - os: macos-15-intel
            arch: x64
            arch-name: Intel
          - os: macos-latest
            arch: arm64
            arch-name: ARM

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'
          cache-dependency-path: electron/package-lock.json

      - name: Setup R
        uses: r-lib/actions/setup-r@v2
        with:
          r-version: '4.4.2'

      - name: Install R packages
        run: |
          install.packages(c('plumber', 'jsonlite', 'promises', 'future', 'later',
                             'httpuv', 'webutils', 'swagger', 'magrittr', 'crayon',
                             'ellipsis', 'lifecycle', 'rlang', 'R6', 'stringi',
                             'sodium', 'digest', 'globals', 'listenv', 'parallelly', 'Rcpp',
                             'stringr', 'tcltk2', 'BiocManager'),
                           repos = 'https://cloud.r-project.org',
                           dependencies = c('Depends', 'Imports', 'LinkingTo'))
          BiocManager::install('Rgraphviz', ask = FALSE, update = FALSE)
        shell: Rscript {0}

      - name: Prepare R Portable for macOS
        run: |
          OUTPUT_DIR="electron/R-portable-mac"

          # Find R.framework
          if [ -d "/Library/Frameworks/R.framework" ]; then
            R_FRAMEWORK="/Library/Frameworks/R.framework"
          elif [ -d "/opt/homebrew/Cellar/r" ]; then
            R_FRAMEWORK=$(find /opt/homebrew/Cellar/r -name "R.framework" -type d | head -1)
          elif [ -d "/usr/local/Cellar/r" ]; then
            R_FRAMEWORK=$(find /usr/local/Cellar/r -name "R.framework" -type d | head -1)
          fi

          echo "R.framework found at: $R_FRAMEWORK"

          # Create output directory
          mkdir -p "$OUTPUT_DIR"

          # Copy R.framework
          cp -R "$R_FRAMEWORK" "$OUTPUT_DIR/"

          # Create bin directory with wrapper scripts
          mkdir -p "$OUTPUT_DIR/bin"

          # Create Rscript wrapper using echo to avoid YAML heredoc issues
          {
            echo '#!/bin/bash'
            echo '# Get the directory of this script (resolving symlinks)'
            echo 'SOURCE="${BASH_SOURCE[0]}"'
            echo 'while [ -h "$SOURCE" ]; do'
            echo '  DIR="$( cd -P "$( dirname "$SOURCE" )" && pwd )"'
            echo '  SOURCE="$(readlink "$SOURCE")"'
            echo '  [[ $SOURCE != /* ]] && SOURCE="$DIR/$SOURCE"'
            echo 'done'
            echo 'SCRIPT_DIR="$( cd -P "$( dirname "$SOURCE" )" && pwd )"'
            echo ''
            echo '# Use R_HOME if already set and valid, otherwise find it'
            echo 'if [ -z "$R_HOME" ] || [ ! -d "$R_HOME/bin" ]; then'
            echo '  # Find R_HOME dynamically - try multiple locations'
            echo '  for CANDIDATE in \'
            echo '    "$SCRIPT_DIR/../R.framework/Resources" \'
            echo '    $(find "$SCRIPT_DIR/../R.framework/Versions" -maxdepth 2 -type d -name "Resources" 2>/dev/null) \'
            echo '  ; do'
            echo '    if [ -n "$CANDIDATE" ] && [ -x "$CANDIDATE/bin/Rscript" ]; then'
            echo '      R_HOME="$CANDIDATE"'
            echo '      break'
            echo '    fi'
            echo '  done'
            echo 'fi'
            echo ''
            echo '# Verify R_HOME is valid'
            echo 'if [ -z "$R_HOME" ] || [ ! -x "$R_HOME/bin/Rscript" ]; then'
            echo '  echo "ERROR: Cannot find Rscript binary. R_HOME=$R_HOME" >&2'
            echo '  echo "SCRIPT_DIR=$SCRIPT_DIR" >&2'
            echo '  ls -la "$SCRIPT_DIR/../R.framework/" >&2 2>/dev/null || true'
            echo '  exit 1'
            echo 'fi'
            echo ''
            echo 'export R_HOME'
            echo 'export DYLD_LIBRARY_PATH="$R_HOME/lib:${DYLD_LIBRARY_PATH:-}"'
            echo 'exec "$R_HOME/bin/Rscript" "$@"'
          } > "$OUTPUT_DIR/bin/Rscript"
          chmod +x "$OUTPUT_DIR/bin/Rscript"

          # CRITICAL: Convert all absolute symlinks in R.framework to relative symlinks
          # This is essential for App Translocation to work on macOS
          echo "Converting absolute symlinks to relative in R.framework..."
          find "$OUTPUT_DIR/R.framework" -type l | while read -r link; do
            target=$(readlink "$link")
            # Check if the symlink is absolute
            if [[ "$target" == /* ]]; then
              # Check if the target exists within our R.framework
              link_dir=$(dirname "$link")
              # Try to find the target within our copied framework
              target_basename=$(basename "$target")
              target_dirname=$(dirname "$target")

              # If target contains R.framework, try to make it relative
              if [[ "$target" == *"R.framework"* ]]; then
                # Extract the part after R.framework
                after_framework=${target#*R.framework}
                new_target="$OUTPUT_DIR/R.framework$after_framework"
                if [ -e "$new_target" ]; then
                  # Calculate relative path from link location to new target
                  rel_target=$(realpath --relative-to="$link_dir" "$new_target" 2>/dev/null || python3 -c "import os.path; print(os.path.relpath('$new_target', '$link_dir'))")
                  echo "  Converting: $link"
                  echo "    From: $target"
                  echo "    To: $rel_target"
                  rm "$link"
                  ln -s "$rel_target" "$link"
                else
                  echo "  WARNING: Cannot convert $link - target $new_target does not exist"
                fi
              else
                echo "  WARNING: Absolute symlink outside R.framework: $link -> $target"
              fi
            fi
          done

          # Ensure Resources symlink exists and is correct
          echo "Checking R.framework structure..."
          ls -la "$OUTPUT_DIR/R.framework/"

          if [ ! -e "$OUTPUT_DIR/R.framework/Resources" ]; then
            echo "Resources symlink missing, creating it..."
            ACTUAL_RESOURCES=$(find "$OUTPUT_DIR/R.framework/Versions" -maxdepth 2 -type d -name "Resources" | head -1)
            if [ -n "$ACTUAL_RESOURCES" ]; then
              # Get relative path from R.framework to the actual Resources
              REL_PATH=$(realpath --relative-to="$OUTPUT_DIR/R.framework" "$ACTUAL_RESOURCES")
              ln -sf "$REL_PATH" "$OUTPUT_DIR/R.framework/Resources"
              echo "Created symlink: Resources -> $REL_PATH"
            fi
          fi

          # Verify symlinks are now relative
          echo "Verifying symlinks are relative..."
          find "$OUTPUT_DIR/R.framework" -type l | while read -r link; do
            target=$(readlink "$link")
            if [[ "$target" == /* ]]; then
              echo "  STILL ABSOLUTE: $link -> $target"
            fi
          done | head -20

          # Verify the Rscript binary exists
          echo "Verifying Rscript binaries..."
          if [ -x "$OUTPUT_DIR/R.framework/Resources/bin/Rscript" ]; then
            echo "Found: $OUTPUT_DIR/R.framework/Resources/bin/Rscript"
          else
            echo "WARNING: $OUTPUT_DIR/R.framework/Resources/bin/Rscript not found or not executable!"
            find "$OUTPUT_DIR/R.framework" -name "Rscript" -type f 2>/dev/null || true
          fi

          # Make sure all binaries are executable
          find "$OUTPUT_DIR/R.framework" -name "Rscript" -type f -exec chmod +x {} \;
          find "$OUTPUT_DIR/R.framework" -name "R" -type f -exec chmod +x {} \;

          # CRITICAL: Patch R and Rscript scripts in R.framework to use dynamic paths
          # These scripts have hardcoded paths like /Library/Frameworks/R.framework/Resources
          echo "Patching R scripts to use dynamic paths..."

          # Find the actual Resources directory
          RESOURCES_DIR=$(find "$OUTPUT_DIR/R.framework/Versions" -maxdepth 2 -type d -name "Resources" | head -1)
          if [ -z "$RESOURCES_DIR" ]; then
            RESOURCES_DIR="$OUTPUT_DIR/R.framework/Resources"
          fi
          echo "Resources directory: $RESOURCES_DIR"

          # Create the dynamic R_HOME detection code as a separate file
          cat > /tmp/r_home_detect.sh << 'DETECT_EOF'
# Dynamic R_HOME detection - patched for portable deployment
if test -n "${R_HOME}"; then
  R_HOME_DIR="${R_HOME}"
else
  # Detect script location dynamically
  _SCRIPT_SOURCE="${BASH_SOURCE[0]:-$0}"
  while [ -L "$_SCRIPT_SOURCE" ]; do
    _SCRIPT_DIR="$( cd -P "$( dirname "$_SCRIPT_SOURCE" )" && pwd )"
    _SCRIPT_SOURCE="$(readlink "$_SCRIPT_SOURCE")"
    [[ $_SCRIPT_SOURCE != /* ]] && _SCRIPT_SOURCE="$_SCRIPT_DIR/$_SCRIPT_SOURCE"
  done
  _SCRIPT_DIR="$( cd -P "$( dirname "$_SCRIPT_SOURCE" )" && pwd )"
  R_HOME_DIR="$( cd "$_SCRIPT_DIR/.." && pwd )"
  unset _SCRIPT_SOURCE _SCRIPT_DIR
fi
DETECT_EOF

          # Patch the R script using sed to replace only the R_HOME_DIR line
          if [ -f "$RESOURCES_DIR/bin/R" ]; then
            echo "Patching $RESOURCES_DIR/bin/R"
            # Show current R_HOME_DIR line
            grep "^R_HOME_DIR=" "$RESOURCES_DIR/bin/R" | head -1 || true

            # Replace the R_HOME_DIR=... line with our dynamic detection
            # First, get line number of R_HOME_DIR assignment
            LINE_NUM=$(grep -n "^R_HOME_DIR=" "$RESOURCES_DIR/bin/R" | head -1 | cut -d: -f1)
            if [ -n "$LINE_NUM" ]; then
              # Create new script: header + detection code + rest of original (minus R_HOME_DIR line)
              {
                head -n $((LINE_NUM - 1)) "$RESOURCES_DIR/bin/R"
                cat /tmp/r_home_detect.sh
                tail -n +$((LINE_NUM + 1)) "$RESOURCES_DIR/bin/R"
              } > "$RESOURCES_DIR/bin/R.patched"
              mv "$RESOURCES_DIR/bin/R.patched" "$RESOURCES_DIR/bin/R"
              chmod +x "$RESOURCES_DIR/bin/R"
              echo "R script patched successfully"
            else
              echo "WARNING: R_HOME_DIR= line not found in R script"
            fi
          fi

          # Patch the Rscript script the same way
          if [ -f "$RESOURCES_DIR/bin/Rscript" ]; then
            echo "Patching $RESOURCES_DIR/bin/Rscript"
            grep "^R_HOME_DIR=" "$RESOURCES_DIR/bin/Rscript" | head -1 || true

            LINE_NUM=$(grep -n "^R_HOME_DIR=" "$RESOURCES_DIR/bin/Rscript" | head -1 | cut -d: -f1)
            if [ -n "$LINE_NUM" ]; then
              {
                head -n $((LINE_NUM - 1)) "$RESOURCES_DIR/bin/Rscript"
                cat /tmp/r_home_detect.sh
                tail -n +$((LINE_NUM + 1)) "$RESOURCES_DIR/bin/Rscript"
              } > "$RESOURCES_DIR/bin/Rscript.patched"
              mv "$RESOURCES_DIR/bin/Rscript.patched" "$RESOURCES_DIR/bin/Rscript"
              chmod +x "$RESOURCES_DIR/bin/Rscript"
              echo "Rscript patched successfully"
            else
              echo "WARNING: R_HOME_DIR= line not found in Rscript"
            fi
          fi

          rm -f /tmp/r_home_detect.sh
          echo "Scripts patched successfully"

          # Verify the patched scripts
          echo "=== Verifying patched R script (first 30 lines) ==="
          head -30 "$RESOURCES_DIR/bin/R" || true
          echo "=== Verifying patched Rscript (first 30 lines) ==="
          head -30 "$RESOURCES_DIR/bin/Rscript" || true

          # Find actual library path and copy installed packages
          ACTUAL_LIB=$(find "$OUTPUT_DIR/R.framework/Versions" -maxdepth 3 -type d -name "library" | head -1)
          if [ -z "$ACTUAL_LIB" ]; then
            ACTUAL_LIB="$OUTPUT_DIR/R.framework/Resources/library"
          fi
          echo "Actual library path: $ACTUAL_LIB"

          if [ -d "$R_LIBS_USER" ]; then
            echo "Copying packages from $R_LIBS_USER to $ACTUAL_LIB"
            cp -R "$R_LIBS_USER"/* "$ACTUAL_LIB/" 2>/dev/null || true
          fi

          echo "R Portable prepared at $OUTPUT_DIR"
          ls -la "$ACTUAL_LIB" | head -30

      - name: Install rchic package from source
        run: |
          # Find actual library path
          LIB_PATH=$(find electron/R-portable-mac/R.framework/Versions -maxdepth 3 -type d -name "library" | head -1)
          if [ -z "$LIB_PATH" ]; then
            LIB_PATH="electron/R-portable-mac/R.framework/Resources/library"
          fi
          echo "Installing rchic to: $LIB_PATH"
          R CMD INSTALL --library="$LIB_PATH" .

      - name: Verify R installation
        run: |
          # Find the actual library path (handles ARM64 vs Intel)
          LIB_PATH=$(find electron/R-portable-mac/R.framework -type d -name "library" | head -1)
          echo "Using library path: $LIB_PATH"
          electron/R-portable-mac/bin/Rscript -e ".libPaths('$LIB_PATH'); library(plumber); cat('plumber OK\n'); library(rchic); cat('rchic OK\n')"

      - name: Install npm dependencies
        run: |
          cd electron
          npm ci

      - name: Build macOS portable folder
        run: |
          cd electron
          npm run build:mac-portable-folder
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Prepare .app for upload
        run: |
          # Find the .app bundle
          APP_PATH=$(find electron/dist-portable-folder -maxdepth 2 -name "*.app" -type d | head -1)
          echo "Found app at: $APP_PATH"
          # Create upload directory and move .app into it
          mkdir -p electron/dist-portable-folder/upload
          mv "$APP_PATH" electron/dist-portable-folder/upload/

      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: Rchic2-Portable-macOS-${{ matrix.arch-name }}
          path: electron/dist-portable-folder/upload/
          retention-days: 30

  # ============================================================================
  # Windows Build
  # ============================================================================
  build-windows:
    runs-on: windows-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'
          cache-dependency-path: electron/package-lock.json

      - name: Setup R
        uses: r-lib/actions/setup-r@v2
        with:
          r-version: '4.4.2'

      - name: Install R packages
        run: |
          install.packages(c('plumber', 'jsonlite', 'promises', 'future', 'later',
                             'httpuv', 'webutils', 'swagger', 'magrittr', 'crayon',
                             'ellipsis', 'lifecycle', 'rlang', 'R6', 'stringi',
                             'sodium', 'digest', 'globals', 'listenv', 'parallelly', 'Rcpp',
                             'stringr', 'tcltk2', 'BiocManager', 'otel'),
                           repos = 'https://cloud.r-project.org',
                           dependencies = c('Depends', 'Imports', 'LinkingTo'))
          BiocManager::install('Rgraphviz', ask = FALSE, update = FALSE)
        shell: Rscript {0}

      - name: Prepare R Portable for Windows
        shell: pwsh
        run: |
          $OUTPUT_DIR = "electron/R-portable-win"
          $R_HOME = $env:R_HOME

          Write-Host "R_HOME: $R_HOME"

          if (-not $R_HOME -or -not (Test-Path $R_HOME)) {
            # Search for R installation
            $searchPaths = @("C:\R", "C:\Program Files\R", "$env:RUNNER_TOOL_CACHE\R")
            foreach ($basePath in $searchPaths) {
              if (Test-Path $basePath) {
                $rPaths = Get-ChildItem $basePath -Directory -ErrorAction SilentlyContinue |
                          Where-Object { $_.Name -match "^R-?\d" } |
                          Sort-Object Name -Descending
                if ($rPaths.Count -gt 0) {
                  $R_HOME = $rPaths[0].FullName
                  break
                }
              }
            }
          }

          if (-not $R_HOME -or -not (Test-Path $R_HOME)) {
            Write-Host "ERROR: R installation not found!"
            exit 1
          }

          Write-Host "Using R from: $R_HOME"

          # Create output directory and copy R
          New-Item -ItemType Directory -Path $OUTPUT_DIR -Force | Out-Null
          Copy-Item -Path "$R_HOME\*" -Destination $OUTPUT_DIR -Recurse -Force

          # Copy installed packages from R_LIBS_USER to R portable
          $R_LIBS_USER = $env:R_LIBS_USER
          if ($R_LIBS_USER -and (Test-Path $R_LIBS_USER)) {
            Write-Host "Copying packages from $R_LIBS_USER to $OUTPUT_DIR\library"
            Copy-Item -Path "$R_LIBS_USER\*" -Destination "$OUTPUT_DIR\library" -Recurse -Force -ErrorAction SilentlyContinue
          }

          Write-Host "R Portable prepared at $OUTPUT_DIR"
          Get-ChildItem "$OUTPUT_DIR\library" | Select-Object -First 30

      - name: Install rchic package from source
        shell: cmd
        run: R CMD INSTALL --library=electron/R-portable-win/library .

      - name: Verify R installation
        shell: pwsh
        run: |
          $rscript = "electron/R-portable-win/bin/Rscript.exe"
          if (!(Test-Path $rscript)) {
            $rscript = "electron/R-portable-win/bin/x64/Rscript.exe"
          }
          & $rscript -e "library(plumber); cat('plumber OK\n'); library(rchic); cat('rchic OK\n')"

      - name: Install npm dependencies
        run: |
          cd electron
          npm ci

      - name: Build Windows portable folder
        run: |
          cd electron
          npm run build:win-portable-folder
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Create ZIP archive
        shell: pwsh
        run: |
          cd electron/dist-portable-folder
          Compress-Archive -Path win-unpacked -DestinationPath Rchic2-Portable-Windows.zip

      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: Rchic2-Portable-Windows
          path: electron/dist-portable-folder/Rchic2-Portable-Windows.zip
          retention-days: 30

  # ============================================================================
  # Create Release (when all builds complete)
  # ============================================================================
  create-release:
    needs: [build-linux, build-macos, build-windows]
    runs-on: ubuntu-latest
    if: startsWith(github.ref, 'refs/tags/') || (github.event_name == 'workflow_dispatch' && github.event.inputs.create_release == 'true')

    steps:
      - name: Download all artifacts
        uses: actions/download-artifact@v4
        with:
          path: artifacts

      - name: List artifacts
        run: |
          echo "Downloaded artifacts:"
          find artifacts -type f -name "*.zip"

      - name: Create Release
        uses: softprops/action-gh-release@v1
        with:
          name: Rchic2 Portable ${{ github.ref_name }}
          body: |
            ## Rchic2 Portable Release

            Download the ZIP file for your platform, extract it, and run the application directly.
            No installation required - all dependencies (including R) are bundled.

            ### Downloads
            - **Linux**: `Rchic2-Portable-Linux.zip`
            - **macOS Intel**: `Rchic2-Portable-macOS-Intel.zip`
            - **macOS ARM (Apple Silicon)**: `Rchic2-Portable-macOS-ARM.zip`
            - **Windows**: `Rchic2-Portable-Windows.zip`

            ### How to use
            1. Download the ZIP for your platform
            2. Extract the archive
            3. Run the executable:
               - Linux: `./Rchic2`
               - macOS: Open `Rchic2.app`
               - Windows: Run `Rchic2.exe`
          files: |
            artifacts/Rchic2-Portable-Linux/Rchic2-Portable-Linux.zip
            artifacts/Rchic2-Portable-macOS-Intel/Rchic2-Portable-macOS-Intel.zip
            artifacts/Rchic2-Portable-macOS-ARM/Rchic2-Portable-macOS-ARM.zip
            artifacts/Rchic2-Portable-Windows/Rchic2-Portable-Windows.zip
          draft: false
          prerelease: false
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
